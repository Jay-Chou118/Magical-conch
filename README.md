# Magical-conch

Near-field communication based on ultrasonic waves 基于超声波的近场通信
音频频率传输工具，支持跨平台音频信号处理与传输

## 优化说明

本项目经过以下优化，显著提升了超声波通信的可靠性和性能：

### 1. 增强纠错能力
- **ECC纠错码优化**: 将纠错字节从`max(8, len/4)`提升到`max(12, len/3)`
- **效果**: 在噪声环境下数据传输成功率显著提高

### 2. 降低信号检测阈值
- **声音标记阈值**: 从`2.0f`降低到`1.5f`
- **效果**: 提高信号检测灵敏度，更容易识别超声波信号

### 3. 增强信号强度
- **音量设置**: 从`10`提升到`25`
- **效果**: 提高信号传输距离和抗干扰能力

### 4. 优化超声波协议参数
- **频率调整**: 超声波协议起始频率从`437`调整到`400`
- **效果**: 更好的频率响应和兼容性

### 5. 优化采样率和帧大小
- **默认采样率**: 从`48000Hz`调整到`44100Hz`
- **频谱历史**: 从`4`增加到`8`
- **播放缓冲区**: 从`16*1024`减少到`8*1024`
- **捕获缓冲区**: 从`1024`减少到`512`
- **效果**: 降低延迟，提高实时性能

### 6. 改进信号检测逻辑
- **容错机制**: 信号检测从要求完全匹配改为允许2位错误
- **效果**: 在噪声环境下仍能正确检测信号

### 7. 默认使用超声波协议
- **协议选择**: 默认使用协议5（超声波Normal）
- **效果**: 专门针对超声波通信优化

## 支持平台
- macOS (已测试)
- Linux (Ubuntu/Debian)
- Windows
- Android (实验性)

## 依赖项

### macOS
```bash
brew install sdl2
```

### Linux
```bash
sudo apt install libsdl2-dev
```

### Windows
```bash
choco install sdl2
```

### 使用方法

```bash
# 编译
mkdir build && cd build
cmake ..
make

# 运行
./magical-conch
```

### 参数说明
- `-cN`: 选择捕获设备N
- `-pN`: 选择播放设备N
- `-tN`: 传输协议 (默认5 - 超声波Normal)
- `-lN`: 固定载荷长度，N在[1, 64]范围内
- `-d`: 使用直接序列扩频(DSS)技术 (默认启用)
- `-v`: 打印生成的音调信息

## 技术细节

本项目使用以下技术实现超声波通信：
- **FFT频谱分析**: 实时分析音频频谱
- **Reed-Solomon纠错码**: 提供强大的错误纠正能力
- **DSS扩频技术**: 直接序列扩频提高抗干扰能力
- **多协议支持**: 支持可听频段和超声波频段通信

###
